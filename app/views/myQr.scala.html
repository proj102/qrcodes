@(custSession: CustomerSession, qr: Qrcode, qrForm: Form[Qrcode], stats: Stats, infosType: Int, infosContent: String)

@import helper._
@import helper.twitterBootstrap._

@main("View my QrCode") {

    @header(custSession)

	<div class="container">
		@informations(infosType, infosContent)
		<div class="hero-unit" style="padding-top: 40px;">
			<div class="row">
				<div class="alert alert-info">
					<strong>Title: </strong>@qr.getTitle() <strong>Creation date: </strong>@qr.getCreationDate() <strong>Place: </strong>@qr.getPlace() <strong>Number of flash(s): </strong>@qr.getFlashs()
				</div>
			</div>
			<div class="row">
				<div class="span5">
					<div id="qrcodeCanvas" class="thumbnail"></div>
					<a href="" id="pngUrl">Save As PNG</a>
				</div>
				<div class="span5" style="font-size:16px;">

					@form(action = routes.MyQr.submit) {
							<input type="hidden" name="id" value="@qr.getId()" />
							@inputText(
								qrForm("redirection"),
								'_label -> "Url of redirection",
								'_help -> "",
								'_error -> "Please choose a valid redirection url."
							)

							@inputText(
								qrForm("title"),
								'_label -> "Qr code's Title",
								'_help -> "",
								'_error -> "Please choose a valid title."
							)

							@inputText(
								qrForm("place"),
								'_label -> "Where is your Qr code",
								'_help -> "",
								'_error -> "Please choose a valid place."
							)
							<input type="submit" class="btn-primary btn-large" value="Modify" />
						}
				</div>
			</div>
				<script>jQuery('#qrcodeCanvas').qrcode({text : "@qr.getUrl()"});</script>
				
		
				<!--Script Javascript converting canvas generated by the QRGenerator into PNG, then modifying an <a> tag with a created url to the PNG image-->
				<script type="text/javascript">
					function putImage()
						{
						  var myCanvas = document.getElementsByTagName("canvas");
						  var canvas1 = myCanvas [0];
						  var ctx = canvas1.getContext("2d");                // Get the context for the canvas.
						  var myImage = canvas1.toDataURL("image/png")      // Get the data as an image.
						
						  var linkElement = document.getElementById("pngUrl");  //Get the a object
						  linkElement.href = myImage;
//						  var uriContent = "data:application/octet-stream," + encodeURIComponent(myImage);
//						  linkElement.href = uriContent;
						} 
						  
					putImage();
				</script>
				
				@if(stats!=null){
				<div class="row">
					<div class="span5" id="chart_div2" style = "margin-top: 30px;">
						<!--Load the AJAX API-->
						<script type="text/javascript" src="https://www.google.com/jsapi"></script>
						<script type="text/javascript">
							google.load("visualization", "1", {packages:["corechart"]});
							google.setOnLoadCallback(drawChart);
							function drawChart() {
								var data = google.visualization.arrayToDataTable([
									['Days', 'Scans'],
									@for(d<- 0 until stats.getMonth().length){
										[@d, @stats.getMonth()(d)],
									}
								]);

								var options = {
									title: 'Scans history',
									hAxis: {title: 'x days ago',},
									'backgroundColor':'none',
									'animation.duration':3000,
									'animation.easing':'inAndOut',
								};

								var chart = new google.visualization.AreaChart(document.getElementById('chart_div2'));
								chart.draw(data, options);
							}
						</script>						
					</div>
					<div class="span5" id="chart_div">
						<script type="text/javascript">

							// Load the Visualization API and the piechart package.
							google.load('visualization', '1.0', {'packages':['corechart']});

							// Set a callback to run when the Google Visualization API is loaded.
							google.setOnLoadCallback(drawChart);

							// Callback that creates and populates a data table,
							// instantiates the pie chart, passes in the data and
							// draws it.
							function drawChart() {

							// Create the data table.
								var data = new google.visualization.DataTable();
								data.addColumn('string', 'User Agent');
								data.addColumn('number', 'Scans');
								data.addRows([
								['Android', @stats.getUserAgent()(0)],
								['iPhone', @stats.getUserAgent()(1)],
								['Windows Phone', @stats.getUserAgent()(2)],
								['BlackBerry', @stats.getUserAgent()(3)],
								['Others', @stats.getUserAgent()(4)]
								]);

								// Set chart options
								var options = {'title':'Users\' terminals',
								       'width':400,
								       'height':300,
								       'backgroundColor':'none',
								       'is3D':'true'};

								// Instantiate and draw our chart, passing in some options.
								var chart = new google.visualization.PieChart(document.getElementById('chart_div'));
								chart.draw(data, options);
							}
					    </script>
					</div>
					}
				</div>
			
		</div>
	</div>
}
